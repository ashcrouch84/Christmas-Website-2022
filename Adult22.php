<?php
	header("Expires: Mon, 26 Jul 1997 05:00:00 GMT");
	header("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT");
	header("Cache-Control: no-store, no-cache, must-revalidate");
	header("Cache-Control: post-check=0, pre-check=0", false);
	header("Pragma: no-cache");
	session_start();
	//echo session_id();
?>
<!doctype html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>

    <link rel="canonical" href="" />
	<link rel = "icon" href = "https://4k-photos.co.uk/The Magical Christmas Adventure Logo.png" type = "image/x-icon">  
   
   <style>
	.topnav a {
		float: center;
		color: #135BBD;
		text-align: center;
		padding: 14px 16px;
		text-decoration: none;
		font-size: 22px;
		border-top:2px solid #777777;
		border-right:2px solid #333333;
		border-bottom:2px solid #444444;
		border-left:2px solid #777777;
		
	}
</style>
    
    <base href="https://bookings.4-kingdoms.co.uk/"/>
<meta charset="utf-8">
<title>Adult Information</title>
<meta name="description" content="">
<meta name="keywords" content="">
 
<meta property="og:locale" content="en_GB" />
<meta property="og:type" content="website" />
<meta property="og:title" content="General Admissions" />
<meta property="og:description" content=""/>
<meta property="og:url" content=""/>
<meta property="og:site_name" content="fusemetrix" />
<meta property="og:image" content=""/>
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="" />
<meta name="twitter:title" content="General Admissions" />
<meta name="twitter:site" content="@fusemetrix" />
<meta name="twitter:creator" content="@fusemetrix" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<!-- Favicons -->
<link rel="apple-touch-icon" sizes="57x57" href="/assets/images/favicons/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/images/favicons/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/images/favicons/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/images/favicons/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/images/favicons/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/images/favicons/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/images/favicons/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/images/favicons/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicons/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/assets/images/favicons/android-icon-192x192.png">


<link rel="mask-icon" href="/assets/images/favicons/safari-pinned-tab.svg" color="#eb008b">
<meta name="msapplication-TileColor" content="#eb008b">
<meta name="theme-color" content="#ffffff">


<link rel="stylesheet" href="https://use.typekit.net/geb1jvd.css">

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link href="/common/assets/css/melon.datepicker.css?cc=" rel="stylesheet" media="none" onload="if(media!='all')media='all'"> 
<noscript>
<link href="/common/assets/css/melon.datepicker.css?cc=" rel="stylesheet"> 
</noscript>
<link  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" rel="stylesheet" type="text/css"  media="none" onload="if(media!='all')media='all'"/>
<link  href="https://cdn.materialdesignicons.com/5.3.45/css/materialdesignicons.min.css" rel="stylesheet" type="text/css"  media="none" onload="if(media!='all')media='all'"/>
<link  href="/assets/css/style.css?cc=16464048233" rel="stylesheet" type="text/css"  media="none" onload="if(media!='all')media='all'"/>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Chewy&family=IBM+Plex+Sans:wght@300;400;600;700&family=Montserrat:wght@300;400;500;600;700;800;900&family=Open+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<noscript>
<link  href="/assets/css/style.css?cc=1646404823" rel="stylesheet" type="text/css"/>
<link href="https://cdn.materialdesignicons.com/5.3.45/css/materialdesignicons.min.css" rel="stylesheet" type="text/css"/>
</noscript>

<!-- JS -->

<!-- GOOGLE RECAPTCHA V3!-->
<script src="https://www.google.com/recaptcha/api.js?render=6LemxN4UAAAAAJipbjTi_jdeNVRxJdWw5f99M5Bd"></script>

<style>
	.grecaptcha-badge {
		opacity: 0 !important;
		left: -9999px !important;
	}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<!-- Bootstrap-->

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>





<script type="application/ld+json">
	 { "@context" : "http://schema.org",
      "@type" : "Organization",
      "legalName" : "",
      "url" : "",
      "logo": "",
      
    }
</script>


    <link type="text/css" rel="stylesheet" href="/shop/includes/css_include.css?v=55" />

    <script type="text/javascript" src="/shop/includes/js_include.php?v=55"></script>

</head>

<body>

    <a href="#content" class="sr-only">Skip to content</a>
<!-- wrapper -->
<div id="wrapper" class="stickyFooter">
	<header id="header" style="position: relative">
		<div class="container">
			<nav class="navbar navbar-expand-lg">
				
			</nav>
		</div>
	</header>
    
    <script>
        $(document).ready(function(){
            $('.navbar-toggler').click(function(){
                $('#navbarSupportedContent').addClass('open');
            });
            
            $('.navbar-header').click(function(){
                $('#navbarSupportedContent').removeClass('open');
            });
        });
    </script>

<?php

	ini_set('display_errors', 1);
	error_reporting(E_ALL);
	
	//remoteFolders
	$remoteFolderA = "X22/hQDo6TUAuImqWENYQjdjMHhdKeiFYqsvMKhMPNBgM7oXUCNkXB4rtBH7i3tYubYh";
	$remoteFolderC = "X22/uzmQIAHBSH6kusMp9tNpbSvEn5IGJKaB5ESX3WUWmPeMVNRnBFxudnt4ubtaAfbJ";
	$remoteFolderF = "X22/3hbQnlLEQA870bKszQg8dIWQ5cLzZm2wOCJj5zym0eFKZwgBn2T0ZS9i03fit53q";
	$password = "TFI4gOfiMnABxa4UG9BuJAh4fUjayi5ySGHVB0XeT3qrgdFh8gj27ArwUUH8pBFZ";
	$limit = 500000;
	$method = 'aes-256-cbc';
	
	$method = 'aes-256-cbc';
				$password = "TFI4gOfiMnABxa4UG9BuJAh4fUjayi5ySGHVB0XeT3qrgdFh8gj27ArwUUH8pBFZ";
				$key = substr(hash('sha256', $password, true), 0, 32);
				// IV must be exact 16 chars (128 bit)
				$iv = chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0);

	
	if (isset($_GET['id']))
		{
			$orderId = $_GET['id'];
		}
	$an="";
	if (isset($_GET['an']))
	{
		$an = $_GET['an'];
	}
	if (isset($_REQUEST['ref_entered']))
		{
			$orderId= trim(strtoupper($_REQUEST['ref_entered']),' ');
		}
	if (isset($_REQUEST['email_entered']))
		{
			$email= trim($_REQUEST['email_entered'],' ');
		}
	$value="";
	if (isset($_REQUEST['value_entered']))
		{
			$value = $_REQUEST['value_entered'];
		}
		
	// Create a connection to the web service
	$ws_username = "4kingdoms";
	$ws_password = "sdfsdiF@%@dIAS82729FBX_322";
	$ws_url = "https://4kingdoms.fusemetrix.com/ws/soap/";
	
	$client = new FuseMetrixWebService_SOAP($ws_username, $ws_password, $ws_url);
	//echo $client->getItWorks(); // Returns 'FMX web service successfully called' if successful
	
	$response = $client->getChristmasBooking($orderId);
	// "<h2>getChristmasBooking(\$orderId)</h2>";
	//echo "<b>Valid example:</b>";
	//echo "<pre>".print_r($response, true)."</pre>";
		
	$familyName = explode(",", $response['address']);
	$message = "Logged in successfully as ".$familyName[0];
	
	$i=0;
	$adultCount =0;
	$count = count($response['booking']);
	while ($i<$count+1)
	{
		if(isset($response['booking'][$i]['37']['answer']))
		{
			$adultCount=$adultCount+1;
			$adultName[]=$response['booking'][$i]['37']['answer'];
			$adultHref[]= "test.php?opt=children&name=".$response['booking'][$i]['37']['answer']."&id=".$orderId;
			$place[] = $i;
		}
		$i=$i+1;
	}
	//echo $adultCount;
?>


    <div class="container py-4">
		<center>
            <h1>Answer Questions about your Adults</h1>
            <div class="mb-3">
				<div class="text-center"><?php echo $message; ?> <br />
                Select one of the adults below and fill in the information<br/>
				<br>
            </div>
			<div class="topnav">
				<?php
					$message = "https://4k-photos.co.uk/Personalise22.php?id=".$orderId."&email_entered=".$email."&ref_entered=".$orderId."&an=".$an;
					$i=0;
					while ($i<$adultCount)
					{
						?>
							<a href=<?php echo "https://4k-photos.co.uk/Adult22.php?id=".$orderId."&email_entered=".$email."&ref_entered=".$orderId."&an=".$adultName[$i]; ?>><?php echo ucfirst($adultName[$i]);?></a>
						<?php
						$i=$i+1;
					}
					?>
						<a href=<?php echo $message;?>>Main Menu</a>
					<?php
				?>
			</div> 
		</center>
		<?php
			if ($an == "")
			{}
			else
			{
				?>
					<center>
						<h1>Filling in information about <?php echo ucfirst($an); ?></h1>
					</center>
				<?php
				
				if ($value == "ai")
					{
						$ARelationship="";
						$AName = "";
						$APresent = "";
						$AFav = "";
						$ANaughty = "";
						$AJob = "";
						$APJob = "";
						$AAchieve = "";
						$ALifeA = "";
						$ALaugh = "";
						$AOldSchool = "";
						$ATeacher = "";
						$AFavC = "";
						$AFavM = "";
						$AProud ="";
						$AWish="";
						$AMess="";
						$AMessChild="";
						if (isset($_REQUEST['relationship_entered'])){$ARelationship = str_replace(',',':',$_REQUEST['relationship_entered']);}
						if (isset($_REQUEST['childhood_entered'])){$APresent = str_replace(',',':',$_REQUEST['childhood_entered']);}
						if (isset($_REQUEST['Naughty_entered'])){$ANaughty = str_replace(',',':',$_REQUEST['Naughty_entered']);}
						if (isset($_REQUEST['job_entered'])){$AJob = str_replace(',',':',$_REQUEST['job_entered']);}
						if (isset($_REQUEST['previous_entered'])){$APJob = str_replace(',',':',$_REQUEST['previous_entered']);}
						if (isset($_REQUEST['adultachievement_entered'])){$AAchieve = str_replace(',',':',$_REQUEST['adultachievement_entered']);}
						if (isset($_REQUEST['lifetimeAchievement_entered'])){$ALifeA = str_replace(',',':',$_REQUEST['lifetimeAchievement_entered']);}
						if (isset($_REQUEST['laugh_entered'])){$ALaugh = str_replace(',',':',$_REQUEST['laugh_entered']);}
						if (isset($_REQUEST['oldSchool_entered'])){$AOldSchool = str_replace(',',':',$_REQUEST['oldSchool_entered']);}
						if (isset($_REQUEST['teacher_entered'])){$ATeacher = str_replace(',',':',$_REQUEST['teacher_entered']);}
						if (isset($_REQUEST['favouriteMemory_entered'])){$AFavM = str_replace(',',':',$_REQUEST['favouriteMemory_entered']);}
						if (isset($_REQUEST['proud_entered'])){$AProud = str_replace(',',':',$_REQUEST['proud_entered']);}
						if (isset($_REQUEST['wish_entered'])){$AWish = str_replace(',',':',$_REQUEST['wish_entered']);}
						if (isset($_REQUEST['special_entered'])){$AMess = str_replace(',',':',$_REQUEST['special_entered']);}
						
						$nName="";
						$orderID="";
						if (isset($_REQUEST['name_entered'])) {$nName = $_REQUEST['name_entered'];}
						if (isset($_REQUEST['ref_entered'])) {$orderID = $_REQUEST['ref_entered'];}
						if($nName == "")
							{
							}
						else
							{
								$ToSave = $an.",".$ARelationship.",".$AName.",".$APresent.",".$AFav.",".$ANaughty.",".$AJob.",".$APJob.",".$AAchieve.",".$ALifeA.",".$ALaugh.",".$AOldSchool.",".$ATeacher.",".$AFavC.",".$AFavM.",".$AProud.",".$AWish.",".$AMess.",".$AMessChild;
				
								//$ToSave = $name.",".$ARelationship.",".$AName.",".$APresent.",".$AFav.",".$ANaughty.",".$AJob.",".$APJob.",".$AAchieve.",".$ALifeA.",".$ALaugh.",".$AOldSchool.",".$ATeacher.",".$AFavC.",".$AFavM.",".$AProud.",".$AWish.",".$AMess.",".$AMessChild;
						
								$encrypted_message =base64_encode(openssl_encrypt($ToSave, $method, $key, OPENSSL_RAW_DATA, $iv));
								$file = $orderID."_".$nName.".txt";
								$filename = $remoteFolderA."/".$file;
								file_put_contents($filename,$encrypted_message);
							}
					}
					
				if ($value == "act")
				{
					$file = $an."_ChristmasToy_".$orderId;
					$messType="ChirstmasToy";
					$target_dir = $remoteFolderA."/";
				}
				if ($value == "ach")
				{
					$file = $an."_Childhood_".$orderId;
					$messType = "Childhood";
					$target_dir = $remoteFolderA."/";
				}
				
				if ($value == "ach" || $value == "act")
				{
					//check if ok to upload
					$uploadOk = 1;
					//varaibles
					$target_file = $target_dir.basename($_FILES["fileToUpload"]["name"]);
					$imageFileType = strtolower(pathinfo($target_file,PATHINFO_EXTENSION));
					
					// Check if image file is a actual image or fake image
					if(isset($_POST["submit"]))
					{
						$checkS = getimagesize($_FILES["fileToUpload"]["tmp_name"]);
						if($checkS !== false)
							{
								//echo "File is an image - " . $check["mime"] . ".";
								$uploadOk = 1;
							}
						else 
							{
								//echo "File is not an image.";
								$uploadOk = 0;
							}
					}
					
					// Allow certain file formats
					if($imageFileType != "jpg"&& $imageFileType != "png" && $imageFileType != "jpeg" && $imageFileType !="gif" && $imageFileType !="bmp") 
					{
						echo "Sorry, only JPG, JPEG, PNG & GIF files are allowed.";
						$uploadOk = 0;
					}
				
					$name=str_replace(' ','-',$an);
					if ($value == "ach"){$new_name=$an."_Childhood_".$orderId.".".$imageFileType;}
					if ($value == "act"){$new_name=$an."_ChristmasToy_".$orderId.".".$imageFileType;}
					$target_file = $target_dir.$new_name;
						
					$res = 100-(($limit/$_FILES["fileToUpload"]["size"])*100);
				
					$tmp_name1 = $_FILES["fileToUpload"]["tmp_name"];	
					if ($imageFileType == "jpg")
					{
						$image = imagecreatefromjpeg($tmp_name1);
						$target_file = preg_replace('"\.jpg"','.jpg',$target_file);
						$xa = imagejpeg($image,$target_file,$res);
						//echo $target_file;
					}
					if ($imageFileType == "png")
					{
						$image = imagecreatefrompng($tmp_name1);
						$target_file = preg_replace('"\.png"','.jpg',$target_file);
						$xa = imagejpeg($image,$target_file,$res);
						//echo $target_file;
					}
					if ($imageFileType =="jpeg")
					{
						$image = imagecreatefromjpeg($tmp_name1);
						$target_file = preg_replace('"\.jpeg"','.jpg',$target_file);
						$xa = imagejpeg($image,$target_file,$res);
						//echo $target_file;
					}
					if ($imageFileType =="gif")
					{
						$image = imagecreatefromgif($tmp_name1);
						$target_file = preg_replace('"\.gif"','.jpg',$target_file);
						$xa = imagejpeg($image,$target_file,$res);
						//echo $xa;
					}
					if ($imageFileType =="bmp")
					{
						$image = imagecreatefrombmp($tmp_name1);
						$target_file = preg_replace('"\.bmp"','.jpg',$target_file);
						$xa = imagejpeg($image,$target_file,$res);
						//echo $xa;
					}

					if ($xa == True)
					{
						ucwords($name)."'s ".$messType." Picture has uploaded successfully<BR>";
						$message = "Picture Successfully uploaded";
						//echo "<p align='center'><font color=red font face='arial' size='2'>".$message."</font></p>";
						//echo "<p align='center'><font color=red font face='arial' size='2'>Please refresh browser to see your picture/s<BR></font></p>";
						//header("Refresh:0");
					} 
					else 
					{
							echo "Sorry, there was an error uploading your file. Error 1";
					}
				
					//set file name
					
					//check if old file exists and type of file
					$filename = $target_dir."/".$file;
					$file_type=0;
					if (file_exists($filename.".jpg"))
					{
						$file_type = 1;
						$del_name = $filename.".jpg";
					}
					if (file_exists($filename.".png"))
					{
						$file_type=2;	
						$del_name = $filename.".png";
					}
					if (file_exists($filename.".jpeg"))
					{
						$file_type=3;
						$del_name = $filename.".jpeg";
					}					
				}
					
					//variables
										$ARelationship="";
										$AName = "";
										$APresent = "";
										$AFav = "";
										$ANaughty = "";
										$AJob = "";
										$APJob = "";
										$AAchieve = "";
										$ALifeA = "";
										$ALaugh = "";
										$AOldSchool = "";
										$ATeacher = "";
										$AFavC = "";
										$AFavM = "";
										$AProud ="";
										$AWish="";
										$AMess="";
										$AMessChild="";
								
										//echo $i;
										//$var_adult = $response['booking'][$i]['37']['answer'];
										//$var_adult=str_replace(' ','-',$var_adult);
										$file = $orderId."_".$an.".txt";
										$filename = $remoteFolderA."/".$file;
										
										$method = 'aes-256-cbc';
										$password = "TFI4gOfiMnABxa4UG9BuJAh4fUjayi5ySGHVB0XeT3qrgdFh8gj27ArwUUH8pBFZ";
										$key = substr(hash('sha256', $password, true), 0, 32);
										// IV must be exact 16 chars (128 bit)
										$iv = chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0) . chr(0x0);
										
										if (file_exists($filename))
											{
												$Ofile = fopen($filename,"r");
												while (! feof($Ofile))
												{
													$line = fgets($Ofile);
												}
												fclose($Ofile);
												$decrypted = openssl_decrypt(base64_decode($line), $method, $key, OPENSSL_RAW_DATA, $iv);
												list($var_adult,$ARelationship,$AName,$APresent,$AFav,$ANaughty,$AJob,$APJob,$AAchieve,$ALifeA,$ALaugh,$AOldSchool,$ATeacher,$AFavC,$AFavM,$AProud,$AWish,$AMess,$AMessChild)=explode(',',$decrypted);
											}
											
											$message = "https://4k-photos.co.uk/Adult22.php?id=".$orderId."&email_entered=".$email."&ref_entered=".$orderId."&an=".$an;
										?>
										
										<body>
										<center>
											<div id="divGroupedProducts">
													<form action=<?php echo $message; ?> method=post enctype='multipart/form-data'>
														<div class="form-input-material">
															<h3>Please enter personal details to use during your Magical Christmas Adventure</label>
														</div>
														<div class="form-input-material">
															<label><?php echo ucfirst($an)."'s Relationship to the children"; ?></label>
															<input type="text" name="relationship_entered" value="<?php echo $ARelationship; ?>" required="" required title="So we know if they are mum, dad, grandad, etc.">
														</div>
														<label><?php echo ucfirst($an)." Favourite Childhood present?"; ?></label>
														<div class="form-input-material">
															<input style="width: 500px; type="text" name="childhood_entered" value="<?php echo $APresent; ?>" required="" required title="So Santa knows what the adult had as a present as a child">
														</div>
														<label><?php echo "What is something naughty that ".ucfirst($an)." has done this year?"; ?></label>
														<div class="form-input-material">
															<input style="width: 500px; type="text" name="Naughty_entered" value="<?php echo $ANaughty; ?>" required="" required>
														</div>
														<label></label>
														<div class="form-input-material">
															<label><?php echo "What is ".ucfirst($an)." 's job?"; ?></label>
															<input type="text" name="job_entered" value="<?php echo $AJob; ?>" required="" required>
														</div>
														<div class="form-input-material">
															<label><?php echo "What is ".ucfirst($an)." previous job?"; ?></label>
															<input type="text" name="previous_entered" value="<?php echo $APJob; ?>" >
														</div>
														<label><?php echo "What is an achievement ".ucfirst($an)." has done this year?"; ?></label>
														<div class="form-input-material">
															<input style="width: 500px; type="text" name="adultachievement_entered"  value="<?php echo $AAchieve; ?>" maxlength="20" title="Bartholomew may talk to your child about this">
														</div>
														<label><?php echo "What is ".ucfirst($an)."'s lifetime achievment?"; ?></label>
														<div class="form-input-material">
															<input style="width: 500px; type="text" name="lifetimeAchievement_entered" value="<?php echo $ALifeA; ?>" >
														</div>
														<label></label>
														<div class="user-box">
															<label><?php echo "Is ".ucfirst($an)." up for a laugh?"; ?></label>
															<select name="laugh_entered" value="<?php echo $ALaugh; ?>">
																<option value="<?php echo $ALaugh; ?>"><?php echo $ALaugh; ?></option>
																<option value="Yes">Yes</option>
																<option value="No">No</option>
															</select>
														</div>
														<div class="form-input-material">														
															<label><?php echo "What school did ".ucfirst($an)." used to attend when a child?"; ?></label>
															<input type="text" name="oldSchool_entered"  value="<?php echo $AOldSchool; ?>" >
														</div>
														<div class="form-input-material">														
															<label><?php echo "Who was ".ucfirst($an)." favourite teacher at school?"; ?></label>
															<input type="textarea" name="teacher_entered" value="<?php echo $ATeacher; ?>" >
														</div>
														<label><?php echo "Does ".ucfirst($an)." have a favourite childhood memory?"; ?></label>
														<div class="form-input-material">
															<input style="width: 500px; type="text" name="favouriteMemory_entered" value="<?php echo $AFavM; ?>">
														</div>
														<label><?php echo "Is ".ucfirst($an)." proud of any of the children? And if so why?"; ?></label>
														<div class="form-input-material">
															<input style="width: 500px; type="text" name="proud_entered" value="<?php echo $AProud; ?>">
														</div>
														<label><?php echo "Does ".ucfirst($an)." have any Christmas wishes?"; ?></label>
														<div class="form-input-material">
															<input style="width: 500px; type="text" name="wish_entered" value="<?php echo $AWish; ?>" >
														</div>
														<label><?php echo "Does ".ucfirst($an)." have a special message for their children?"; ?></label>
														<div class="form-input-material">
															<input style="width: 500px; type="text" name="special_entered" value="<?php echo $AMess; ?>">
														</div>
														<br>
														<button type="submit" class="btn btn-primary btn-ghost"><?php echo "Update ".ucfirst($an)."'s Information"; ?></button>
														<br>
														<input type="hidden" name="name_entered" value=<?php echo $an; ?>>
														<input type="hidden" name="ref_entered" value=<?php echo $orderId; ?>>
														<input type="hidden" name="value_entered" value="ai">
														<br>
													</form>
												</div>
											</body>
										<?php
										
									$christmastoyPic = $remoteFolderA."/".$an."_ChristmasToy_".$orderId.".jpg";
									$childhoodPic =$remoteFolderA."/".$an."_Childhood_".$orderId.".jpg";
									

				$message = "https://4k-photos.co.uk/Adult22.php?id=".$orderId."&email_entered=".$email."&ref_entered=".$orderId."&an=".$an;
				?>
				
				<center>
					<h1>Upload Pictures for <?php echo ucfirst($an); ?></h1>
				</center>

				<form action= <?php echo $message?> method=post enctype='multipart/form-data' id="imageform" name="imageform">
					<center>
						<div>
							<h3><?php echo "Picture of a Christmas present ".ucfirst($an)." got as a child"; ?></h3>
						</div>
					</center>
					<?php
						if (file_exists($christmastoyPic))
						{
							$christmastoyPic = "https://4k-photos.co.uk/".$christmastoyPic.'?'.rand(99,9999);
							?>
								<center>
									<p>
										<img src=<?php echo $christmastoyPic; ?> alt="centered image" width="250" height="250"/>
									</p>
								</center>
								<a>
									<center><input accept="image/png, image/gif, image/jpeg"  required type="file" name="fileToUpload" id="fileToUpload" value="Choose file to replace"></center>
									<input type="hidden" name="name_entered" value=<?php echo $an; ?>>
									<input type="hidden" name="ref_entered" value=<?php echo $orderId; ?>>
									<input type="hidden" name="value_entered" value="act">
									<center><input type="submit" value="Replace Christmas Toy Picture" name="submit"></center>
								</a>
							<?php
						}
						else
						{
							?>
								<a>
									<center><input accept="image/png, image/gif, image/jpeg"  required type="file" name="fileToUpload" id="fileToUpload"></center>
									<input type="hidden" name="name_entered" value=<?php echo $an; ?>>
									<input type="hidden" name="ref_entered" value=<?php echo $orderId; ?>>
									<input type="hidden" name="value_entered" value="act">
									<center><input type="submit" value="Upload New Christmas Toy Picture" name="submit"></center>
								</a>
							<?php
						}
					?>
				</form>
				<br>
				<form action= <?php echo $message?> method=post enctype='multipart/form-data' id="imageform" name="imageform">
					<center>
						<div>
							<h3><?php echo "Picture of ".ucfirst($an)." as a child"; ?></h3>
						</div>
					</center>
					<?php
						if (file_exists($childhoodPic))
						{
							$childhoodPic = "https://4k-photos.co.uk/".$childhoodPic.'?'.rand(99,9999);
							?>
								<center>
									<p>
										<img src=<?php echo $childhoodPic; ?> alt="centered image" width="250" height="250"/>
									</p>
								</center>
								<a>
									<center><input accept="image/png, image/gif, image/jpeg"  required type="file" name="fileToUpload" id="fileToUpload" value="Choose file to replace"></center>
									<input type="hidden" name="name_entered" value=<?php echo $an; ?>>
									<input type="hidden" name="ref_entered" value=<?php echo $orderId; ?>>
									<input type="hidden" name="value_entered" value="ach">
									<center><input type="submit" value="Replace Child Picture" name="submit"></center>
								</a>
							<?php
						}
						else
						{
							?>
								<a>
									<center><input accept="image/png, image/gif, image/jpeg"  required type="file" name="fileToUpload" id="fileToUpload"></center>
									<input type="hidden" name="name_entered" value=<?php echo $an; ?>>
									<input type="hidden" name="ref_entered" value=<?php echo $orderId; ?>>
									<input type="hidden" name="value_entered" value="ach">
									<center><input type="submit" value="Upload New Childhood Picture" name="submit"></center>
								</a>
							<?php
						}
					?>
				</form>
				<?php
			}
		?>
    </div>
	<br>
	 <div id="divGroupedProducts">
		<center>
			<form action="https://4k-photos.co.uk/Personalise22.php"  >
			<input type="hidden" id="email_entered" name="email_entered" value=<?php echo "$email"; ?>>
			<input type="hidden" id="ref_entered" name="ref_entered" value=<?php echo "$orderId"; ?>>
			<button type="submit" class="btn btn-primary btn-ghost">Return to Information Page</button>
		</form>
		</center>
	</div>
    <br>
    <script>
$('.dropdown').hover(function() {
	$(this).find('.dropdown-menu').toggleClass('show');
});
</script>
	<div id="footer" style=>
        <div id="subFooter" class="py-3 py-md-5">
            <div class="container">
                <div class="row">
                    <div class="col-12 col-md-4">
                        <div class="footer__logo text-center text-md-left">
                            <a href="https://4-kingdoms.co.uk/">
                                <img class="logo h-100" src="/assets/images/4-kingdoms-logo-footer.png" alt="4 kingdoms adventure park" />
                            </a>
                        </div>
                    </div>
                    <div class="col-12 col-md-4 text-center text-md-left">
                        <p>
                            <strong>4 Kingdoms Adventure &amp; Farm Park is a place to create memories for old and young alike. </strong>
                            <strong>With over 21 play zones and events held all year we pride ourselves on being a family-friendly safe environment.</strong>
                        </p>
                        
                        <div class="mt-4 footer__social mx-auto mx-md-0">
                            <a href="https://www.facebook.com/4kingdomsadventurepark/" target="_blank" rel="attachment noopener wp-att-47876">
                                <img class="" src="/assets/images/facebook-footer-icon.jpg" alt="facebook-logo-full-color"  />
                            </a>
                            <a href="https://www.youtube.com/channel/UCRl2VoE1oecV_ZS2Untd5UA" target="_blank" rel="attachment noopener wp-att-47875">
                                <img class="" src="/assets/images/youtube-footer-icon.jpg" alt="youtube-logo-full-color" />
                            </a>
                            <a href="https://www.instagram.com/4kingdomsadventurepark/" target="_blank" rel="attachment noopener wp-att-47877">
                                <img class="" src="/assets/images/insta-footer-icon.jpg" alt="insta-logo-full-color" />
                            </a>
                            <a href="https://twitter.com/4KingdomsPlay" target="_blank" rel="attachment noopener wp-att-47874">
                                <img class="" src="/assets/images/twitter-footer-icon.jpg" alt="twitter-logo-full-color" />
                            </a>
                        </div>
                    </div>
                    <div class="col-12 col-md-4 text-center text-md-left">
                        <a href="https://goo.gl/maps/q2YQo1SYHQbdUwLU7" target="_blank" >
                            <img width="300" height="185" src="/assets/images/4kingdoms-map.jpg" alt="4-Kingdoms-Static-Map5"  />
                        </a>
                    </div>
                    <div class="col-12 text-center mt-5">
                        <div class="text-center mb-0">&copy;2020 - 4 Kingdoms Adventure & Farm Park - All Rights Reserved.</div>
                        <div class="text-center">
                            <span class="font-weight-bold">Address</span>: Newbury Rd, Headley RG19 8JY - <span class="font-weight-bold">Tel</span>: <a href="tel:01635 269678">01635 269678</a> - <span class="font-weight-bold">Email</span>: <a href="mailto:manager@4-kingdoms.co.uk">manager@4-kingdoms.co.uk</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
	</div>
</div>


    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <h1 class="pageTitle text-center mt-3">Login</h1>
                    <div class="col-12 mt-4">
                                                                    
                                                <!--<form method="post" id="loginform">-->
                        <form method="post" id="loginform" action="/user/login.php">
                        <input type="hidden" id="urltogoto" name="urltogoto" value="/my-account"/>                      
                        <input type="text" name="username" value="" placeholder="Username" class="form-control mb-2" required>
                        <input type="password" name="password" placeholder="Password" class="form-control mb-2" required>
                        <input type="submit" class="btn btn-primary w-100 mb-3" value="Login">
                        </form>
                        <p>Forgotten your password? <a href="/forgotten-password">Reset password</a></p>
                        <p>Create an account? <a href="/register">Click here</a></p>
            
                        <div class="clear"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

            
<div class="modal fade" id="voucherRedeemModalCenter" tabindex="-1" role="dialog" aria-labelledby="voucherRedeemModalTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="voucherRedeemModalTitle">Voucher Accepted</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Simply book one of our activities and the cost will be deducted in your basket
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Let's go</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalUserPhoto" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Customer Photo</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			</div>
			<div class="modal-body">
				<p>You can retake your photo as many times as you like, when you're happy with you photo press save. <span class="text-danger">Once your photo has been saved, if you need to change this please contact us.</span></p>
				<div class="d-flex justify-content-center">
					<div id="divUserCamera"></div>
                    <input type="hidden" id="photoUserKey">
				</div>
			</div>
			<div class="modal-footer justify-content-between">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary" id="btnTakeUserPhoto" onclick="takeUserPhoto();">Take Photo</button>
				<button type="button" class="btn btn-primary" id="btnResetUserPhoto" onclick="resetUserPhoto();">Retake</button>
				<button type="button" class="btn btn-success" id="btnSaveUserPhoto" onclick="saveUserPhoto();">Save</button>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="modalImage" tabindex="-1" role="dialog" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-body" id="divModalImage"></div>
		</div>
	</div>
</div>

<div class="modal fade" id="modalMembership" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Review &amp; Confirm</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body" id="divMembershipReview"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="$('#frm').submit();this.disabled=true;">Add to Basket</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalMemberBookNow" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content">
            <form id="frmMemberBookNow" action="/booking/buildSessionGroup.php" method="post">
                <input type="hidden" name="makeBooking" value="1">
                <input type="hidden" name="userId" id="userId" value="">
                <input type="hidden" name="categoryId" id="categoryId" value="18">
                <input type="hidden" name="locationId" id="locationId">
                <div class="modal-header">
                    <h5 class="modal-title">Book Now</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body" id="divSingleProducts">
                    <h3>Members </h3><p>Please select which member will be attending</p>
                    <div id="divMemberProducts" class="mb-3"></div>
                    <h3>Additional Tickets </h3>
					<p>Please only add tickets if you are attending with guests</p>
                    <div id="divAdditionalProducts"></div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary" id="btnBookNow">Book Now</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="modalAddFriendsMembership" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <form id="frmAddFriendsMembership" method="post">
                <input type="submit" style="display:none;" />
                <input type="hidden" name="linkMembership" value="1">
                <input type="hidden" name="categoryId" value="18">
                <input type="hidden" name="mainMembershipId" value="">
                <input type="hidden" name="linkMembershipId" id="linkMembershipId">
                <div class="modal-header">
                    <h5 class="modal-title">Add a Friend's Membership</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="addFriendCardNumber">Your Friend's Card Number</label>
                            <input type="text" class="form-control" id="addFriendCardNumber" required>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="addFriendSurname">Your Friend's Surname</label>
                            <input type="text" class="form-control" id="addFriendSurname" required>
                        </div>
                    </div>
                    <div id="divAddFriendsMembership"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="searchFriendMemberships();">Search</button>
                    <button type="submit" class="btn btn-success" style="display:none;" id="btnAddFriendsMembership">Add</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="modalBuyVoucher" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <input type="hidden" id="buyVoucherLocationId">
        <input type="hidden" id="buyVoucherProductId">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Buy Voucher</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body" id="divBuyVoucher">
                <div id="buyVoucherQtyWrap" class="form-group row">
                    <label for="buyVoucherQty" class="col-sm-2 col-form-label font-weight-bold">Qty</label>
                    <div class="col-sm-10">
                        <div class="input-group">
                            <div class="input-group-prepend">
                                <button type="button" class="btn btn-primary qtyIncrement" data-add="-1"><i class="mdi mdi-minus"></i></button>
                            </div>
                            <input type="text" class="form-control text-center border" id="buyVoucherQty" placeholder="0" value="0">
                            <div class="input-group-append">
                                <button type="button" class="btn btn-primary qtyIncrement" data-add="1"><i class="mdi mdi-plus"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group row" id="voucherTypeWrap">
                    <label for="buyVoucherQty" class="col-sm-2 col-form-label font-weight-bold">Type</label>
                    <div class="col-sm-10" id="divVoucherPricingTypes"></div>
                </div>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" style="display:none;" id="btnAddVoucher" onclick="addVoucher();">Add To Basket</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalBuyVoucherSuccess" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Success</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">
                <p>The voucher has been added to your basket.</p>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Continue Shopping</button>
                <a href="/basket" class="btn btn-primary">Checkout</a>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalAvailableProductsSummary" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <form id="frmModalAvailableProducts" action="/booking/activityGrouped.php" method="get">
                <input type="hidden" name="addAllToBasket" value="1">
                <div class="modal-header">
                    <h3 class="modal-title" id="exampleModalLongTitle">Booking Summary</h3>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-12">
                            <p class="text-center" id="timeRem">You have <span id="minsRem">05</span>:<span id="secsRem">00</span> to complete your booking</p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <strong>Activities:</strong><br>
                            <div id="availSummaryActivities"></div>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-6">
                            <div class="row">
                                <div class="col-12 col-md-6 font-weight-bold">Date:</div>
                                <div class="col-12 col-md-6 text-md-right" id="availSummaryDate"></div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="row">
                                <div class="col-12 col-md-6 font-weight-bold">Time:</div>
                                <div class="col-12 col-md-6 text-md-right" id="availSummaryTime"></div>
                            </div>
                        </div>
                    </div>
                    <hr />
                    <div class="row justify-content-md-end mt-2">
                        <div class="col-6">
                            <div class="row">
                                <div class="col-12 col-md-6 font-weight-bold">Total:</div>
                                <div class="col-12 col-md-6 text-md-right">
                                    &pound;<span id="availSummaryTotalPrice"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer justify-content-between">
                    <a class="btn btn-secondary text-white" data-dismiss="modal">Change Date/Time</a>
                    <a href="#" onclick="$('#frmModalAvailableProducts').submit(); return false;" class="btn btn-primary allow-navigation">Book Now</a>
                </div>
            </form>
        </div>
    </div>
</div>
    
</body>

</html>

<?php
// Example classes to connect to the web service and call the methods
// You shouldn't need to make any changes to these functions!

class FuseMetrixWebService_SOAP {
    private $client;
    private $username;
    private $password;
    private $token;
    private $headersGenerated;

    function __construct($username, $password, $url) {
        $this->client = new SoapClient(null, array("location" => $url, "uri" => "fusemetrix", "soap_version" => SOAP_1_2));
        $this->username = $username;
        $this->password = $password;
        $this->getToken();
        $this->headersGenerated = false;
    }

    private function getToken($force = false) {
        if($force || !isset($_SESSION["fmxwebservice_soap"]["token"])) {
            $this->token = $this->client->requestToken($this->username);
            $_SESSION["fmxwebservice_soap"]["token"] = $this->token;
        } else {
            $this->token = $_SESSION["fmxwebservice_soap"]["token"];
        }
    }

    private function generateHeaders() {
        $digest = md5($this->password . $this->token);
        $usernameToken = new SoapHeaderUsernameToken($this->username, $digest);
        
        $soapHeaders[] = new SoapHeader("fusemetrix", "auth", $usernameToken);

        $this->client->__setSoapHeaders($soapHeaders);
    }

    public function __call($function, $arguments) {
        if(!$this->headersGenerated) {
            $this->generateHeaders();
        }
        try {
            return $this->client->__soapCall($function, $arguments);
        } catch (SoapFault $e) {
            if($e->faultcode == "0002") {
                $this->client->__setSoapHeaders(null);
                $this->getToken(true);
                $this->generateHeaders();
                return $this->client->__soapCall($function, $arguments);
                throw($e);
            }
        }
    }
}

class SoapHeaderUsernameToken {
    public $digest;
    public $username;

    public function __construct($l, $d) {
        $this->digest = $d;
        $this->username = $l;
    }
}
?>
